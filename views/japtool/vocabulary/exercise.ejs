<script>
    $('.slider-for').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        fade: false,
        asNavFor: '.slider-nav',
        draggable: true,
        prevArrow: '<button type="button" data-role="none" class="btn btn-show-list btn-arrow-left-exe" aria-label="Previous" tabindex="0" role="button"><i class="fa fa-chevron-left"></i></button>',
        nextArrow: '<button type="button" data-role="none" class="btn btn-show-list btn-arrow-right-exe" aria-label="Next" tabindex="0" role="button"><i class="fa fa-chevron-right"></i></button>'
    });
    $('.slider-nav').slick({
        slidesToShow: 3,
        slidesToScroll: 3,
        asNavFor: '.slider-for',
        dots: false,
        centerMode: false,
        focusOnSelect: true
    });
    $('.slider-for').on('init reInit afterChange', function (event, slick, currentSlide) {
        var i = (currentSlide ? currentSlide : 0) + 1;
    });
    var audioconfig = true;
    $(document).ready(function () {
        $('.mic-off').hide();
        $('.mic-on').on('click', function () {
            $('.mic-off').show();
            $('.mic-on').hide();
            audioconfig = false;
        });
        $('.mic-off').on('click', function () {
            $('.mic-on').show();
            $('.mic-off').hide();
            audioconfig = true;
        });
    });
    // Google TEXT TO SPEECH
    function text2speech(w, tl, id) {
        var speech = 'select * from data.uri where url="http://translate.google.com/translate_tts?ie=utf-8&tl=' + encodeURIComponent(tl) + "&q=" + encodeURIComponent(w) + '"';
        $.getJSON('https://query.yahooapis.com/v1/public/yql?q=' + encodeURIComponent(speech) + '&format=json&diagnostics=true', function (data) {
            var audioSrc = data.query.results.url;
            if (data && audioSrc !== undefined) {
                $('#' + id)[0].src = audioSrc;
            }
        });
    }
    function playAudio(id) {
        if (audioconfig) {
            $('#' + id)[0].play();
        }
    }
    //END TEXT2SPEECH
    $('.slider-for').on('init reInit afterChange', function (event, slick, currentSlide) {
        var i = (currentSlide ? currentSlide : 0) + 1;
    });
    function checkAnswer(description, description2, optionID) {
        if (description == description2) {
            if (audioconfig) {
                $("#audioTrue").trigger('play');
            }
            // set color
            var $el = $('#' + optionID),
                    x = 200,
                    originalColor = $el.css("background"),
                    i = 3; //counter
            (function loop() { //recurisve IIFE
                $el.css("background", "#13B192");
                setTimeout(function () {
                    $el.css("background", originalColor);
                }, x);
            }());
            //Trễ 2s và next sang câu tiếp theo.
            setTimeout(
                    function () {
                        $('.slider-for').slick('slickNext');
                    }, 1000);
        } else {
            if (audioconfig) {
                $("#audioFalse").trigger('play');
            }
            // set color
            var $el = $('#' + optionID),
                    x = 200,
                    originalColor = $el.css("background"),
                    i = 3; //counter
            (function loop() { //recurisve IIFE
                $el.css("background", "#EA5552");
                setTimeout(function () {
                    $el.css("background", originalColor);
                }, x);
            }());
        }
    }

    // count page
    var $status = $('.pagingCnt');
    var $slickElement = $('.slider-for');
    $slickElement.on('init reInit afterChange', function (event, slick, currentSlide, nextSlide) {
        //currentSlide is undefined on init -- set it to 0 in this case (currentSlide is 0 based)
        var i = (currentSlide ? currentSlide : 0) + 1;
        $status.text(i + '/' + slick.slideCount);
    });
</script>

<div class="exe-voca">

    <!--div audio-->
    <audio id="audioTrue">
        <source src="/sound/true.wav" type="audio/wav">
    </audio>
    <audio id="audioFalse">
        <source src="/sound/false.wav" type="audio/wav">
    </audio>
    <!--finish div audio-->

    <% if(vocabularies == null || vocabularies.length == 0){ %>
    <h5 class="text-center text-danger">Không tìm thấy dữ liệu</h5>
    <% }else{ %>
    <div class="slider slider-for">
        <%
            var sumPage = vocabularies.length;
                vocabularies.forEach( function(vocabulary, index){ %>
        <div class="excercise-kanji">
            <div class="col-sm-offset-2 col-sm-8">
                <i class="fa fa-microphone mic-on" title="Off Audio"></i>
                <i class="fa fa-microphone-slash mic-off" title="On Audio"></i>
            </div>
            <div class="col-sm-offset-2 col-sm-8">
                <div class="panel panel-default panel-paper-slide">
                    <div class="panel-body">
                        <div class="vocabulary text-center">
                            <div class="card">
                                <div class="front">
                                    <h3 class="text-center text-danger text-center-exe"
                                        onclick="playAudio('vocabulary-audio-<%= index %>');"><%= vocabulary.item %>
                                    </h3>
                                    <audio id="vocabulary-audio-<%= index %>"></audio>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <% vocabulary.randomVocabularies.forEach( function(description, indexOption){ %>
                            <div class="row">
                                <div class="col-sm-offset-1 col-sm-10">
                                    <div class="panel panel-default text-center panel-choose-exe">
                                        <div id="<%= indexOption %>-<%= index %>" class="panel-body"
                                             onclick="checkAnswer('<%= description %>','<%= vocabulary.description %>','<%= indexOption %>-<%= index %>')">
                                            <%= description %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% }) %>
                        </div>
                        <div class="col-sm-offset-10 col-sm-1">
                            <span class="pagingCnt">1/<%= sumPage %></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <% }) %>
    </div>
    <div class="col-sm-offset-2 col-sm-8">
        <div class="slider slider-nav">
            <% vocabularies.forEach( function(vocabulary, index){ %>
            <div><h3><%= vocabulary.item %></h3></div>
            <% }) %>
        </div>
    </div>
    <% } %>
</div>
<!--GET AUDIO DATA-->
<% vocabularies.forEach( function(vocabulary, index){ %>
<script>
    text2speech('<%= vocabulary.reading %>', 'ja', 'vocabulary-audio-<%= index %>');
</script>
<% }) %>
<!--END GET AUDIO DATA-->
